

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ally.design.processor &mdash; ally-py 1.0b1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0b1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ally-py 1.0b1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ally-py 1.0b1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for ally.design.processor</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on Jun 11, 2012</span>

<span class="sd">@package: utilities</span>
<span class="sd">@copyright: 2012 Sourcefabric o.p.s.</span>
<span class="sd">@license: http://www.gnu.org/licenses/gpl-3.0.txt</span>
<span class="sd">@author: Gabriel Nistor</span>

<span class="sd">Module containing the support for a chained processors execution of context type objects.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">ally.design.context</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Attribute</span><span class="p">,</span> <span class="n">DEFINED</span><span class="p">,</span> <span class="n">OPTIONAL</span><span class="p">,</span> \
    <span class="n">ContextMetaClass</span><span class="p">,</span> <span class="n">REQUIRED</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isclass</span><span class="p">,</span> <span class="n">isfunction</span><span class="p">,</span> <span class="n">getfullargspec</span><span class="p">,</span> <span class="n">ismethod</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c"># --------------------------------------------------------------------</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># --------------------------------------------------------------------</span>

<div class="viewcode-block" id="Processor"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Processor">[docs]</a><span class="k">class</span> <span class="nc">Processor</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The processor specification.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;contexts&#39;</span><span class="p">,</span> <span class="s">&#39;call&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;fileName&#39;</span><span class="p">,</span> <span class="s">&#39;lineNumber&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contexts</span><span class="p">,</span> <span class="n">call</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">lineNumber</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the processor for the provided context having the provided call. The name, fileName and lineNumber</span>
<span class="sd">        are used mainly as a reference whenever reporting a problem related to the processor.</span>
<span class="sd">        </span>
<span class="sd">        @param contexts: dictionary{string, ContextMetaClass}</span>
<span class="sd">            The contexts to be associated with the processor.</span>
<span class="sd">        @param call: callable</span>
<span class="sd">            The call of the processor.</span>
<span class="sd">        @param name: string</span>
<span class="sd">            The call function name, used for error reporting references.</span>
<span class="sd">        @param fileName: string</span>
<span class="sd">            The file name where the function is located, used for error reporting references.</span>
<span class="sd">        @param lineNumber: integer</span>
<span class="sd">            The line number where the function is located, used for error reporting references.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contexts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid contexts </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">contexts</span>
        <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">call</span><span class="p">),</span> <span class="s">&#39;Invalid call </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">call</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s">&#39;Invalid call name </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s">&#39;Invalid file name </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fileName</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lineNumber</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s">&#39;Invalid line number </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">lineNumber</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">clazz</span> <span class="ow">in</span> <span class="n">contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s">&#39;Invalid context name </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">ContextMetaClass</span><span class="p">),</span> <span class="s">&#39;Invalid context class </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">contexts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span> <span class="o">=</span> <span class="n">call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">fileName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineNumber</span> <span class="o">=</span> <span class="n">lineNumber</span>

<div class="viewcode-block" id="Processor.register"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Processor.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processing</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Register the processor call into the provided processing. The order in which the register functions are called</span>
<span class="sd">        is provided by an assembler, so usually the call should be only appended to the processors deque in the</span>
<span class="sd">        processing.</span>
<span class="sd">        </span>
<span class="sd">        @param processing: Processing</span>
<span class="sd">            The processing to register to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processing</span><span class="p">,</span> <span class="n">Processing</span><span class="p">),</span> <span class="s">&#39;Invalid processing </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processing</span>
        <span class="n">processing</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">contexts</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">call</span>
</div>
<div class="viewcode-block" id="Function"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Function">[docs]</a><span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Processor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A processor that takes as the call a function and automatically populates name, fileName and lineNumber.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contexts</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructs a processor based on a function.</span>
<span class="sd">        @see: Processor.__init__</span>
<span class="sd">        </span>
<span class="sd">        @param function: function|method</span>
<span class="sd">            The function of the processor.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">function</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ismethod</span><span class="p">(</span><span class="n">function</span><span class="p">),</span> <span class="s">&#39;Invalid function </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">function</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">__code__</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">contexts</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">function</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">cd</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">cd</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Contextual"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Contextual">[docs]</a><span class="k">class</span> <span class="nc">Contextual</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A processor that takes as the call a function and uses the annotations on the function arguments to extract the</span>
<span class="sd">    contexts.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Contextual.contextsFrom"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Contextual.contextsFrom">[docs]</a>    <span class="k">def</span> <span class="nf">contextsFrom</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">annotations</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provides the contexts based on the provided list of arguments and annotations.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">contexts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
            <span class="n">clazz</span> <span class="o">=</span> <span class="n">annotations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clazz</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Expected an annotation of class for argument </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isclass</span><span class="p">(</span><span class="n">clazz</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Not a class </span><span class="si">%s</span><span class="s"> for argument </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">Context</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Not a context class </span><span class="si">%s</span><span class="s"> for argument </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="n">contexts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">clazz</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">contexts</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Cannot have a function with no context&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">contexts</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructs a processor based on a function.</span>
<span class="sd">        @see: Function.__init__</span>
<span class="sd">        </span>
<span class="sd">        @param function: function|method</span>
<span class="sd">            The function of the processor with the arguments annotated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">function</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ismethod</span><span class="p">(</span><span class="n">function</span><span class="p">),</span> <span class="s">&#39;Invalid function </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">function</span>
        <span class="n">fnArgs</span> <span class="o">=</span> <span class="n">getfullargspec</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnArgs</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;The processor function needs at least two arguments (self, chain)&#39;</span>
        <span class="k">assert</span> <span class="s">&#39;self&#39;</span> <span class="o">==</span> <span class="n">fnArgs</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
        <span class="s">&#39;The processor needs to be tagged in a class definition (needs self as the first argument)&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contextsFrom</span><span class="p">(</span><span class="n">fnArgs</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">fnArgs</span><span class="o">.</span><span class="n">annotations</span><span class="p">),</span> <span class="n">function</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ContextualProceed"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.ContextualProceed">[docs]</a><span class="k">class</span> <span class="nc">ContextualProceed</span><span class="p">(</span><span class="n">Processor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A processor that takes as the call a function and uses the annotations on the function arguments to extract the</span>
<span class="sd">    contexts. The function will not receive the chain as an argument and will always proceed.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructs a processor based on a function.</span>
<span class="sd">        @see: Processor.__init__</span>
<span class="sd">        </span>
<span class="sd">        @param function: function|method</span>
<span class="sd">            The function of the processor with the arguments annotated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">function</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ismethod</span><span class="p">(</span><span class="n">function</span><span class="p">),</span> <span class="s">&#39;Invalid function </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">function</span>
        <span class="n">fnArgs</span> <span class="o">=</span> <span class="n">getfullargspec</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnArgs</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;The processor function needs at least one argument (self)&#39;</span>
        <span class="k">assert</span> <span class="s">&#39;self&#39;</span> <span class="o">==</span> <span class="n">fnArgs</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
        <span class="s">&#39;The processor needs to be tagged in a class definition (needs self as the first argument)&#39;</span>

        <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="o">**</span><span class="n">keyargs</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">Chain</span><span class="p">),</span> <span class="s">&#39;Invalid processors chain </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">chain</span>
            <span class="n">function</span><span class="p">(</span><span class="o">**</span><span class="n">keyargs</span><span class="p">)</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">proceed</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">function</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ismethod</span><span class="p">(</span><span class="n">function</span><span class="p">),</span> <span class="s">&#39;Invalid function </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">function</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">__code__</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">Contextual</span><span class="o">.</span><span class="n">contextsFrom</span><span class="p">(</span><span class="n">fnArgs</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">fnArgs</span><span class="o">.</span><span class="n">annotations</span><span class="p">),</span> <span class="n">call</span><span class="p">,</span> <span class="n">function</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                         <span class="n">cd</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">cd</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="p">)</span>

<span class="c"># --------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="Processing"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Processing">[docs]</a><span class="k">class</span> <span class="nc">Processing</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Container for processor&#39;s, provides chains for their execution.</span>
<span class="sd">    !!! Attention, never ever use a processing in multiple threads, only one thread is allowed to execute </span>
<span class="sd">    a processing at one time.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;contexts&#39;</span><span class="p">,</span> <span class="s">&#39;calls&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contexts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the processing.</span>
<span class="sd">        </span>
<span class="sd">        @param contexts: dictionary{string, Context class}</span>
<span class="sd">            The contexts to be associated with the processing.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contexts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid contexts </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">contexts</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">clazz</span> <span class="ow">in</span> <span class="n">contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s">&#39;Invalid context name </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">ContextMetaClass</span><span class="p">),</span> <span class="s">&#39;Invalid context class </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span> <span class="o">=</span> <span class="n">contexts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

<div class="viewcode-block" id="Processing.newChain"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Processing.newChain">[docs]</a>    <span class="k">def</span> <span class="nf">newChain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructs a new processors chain.</span>
<span class="sd">        </span>
<span class="sd">        @return: Chain</span>
<span class="sd">            The chain of processors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">Chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Chain"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Chain">[docs]</a><span class="k">class</span> <span class="nc">Chain</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A chain that contains a list of processors (callables) that are executed one by one. Each processor will have</span>
<span class="sd">     the duty to proceed with the processing if is the case by calling the chain.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;_calls&#39;</span><span class="p">,</span> <span class="s">&#39;_consumed&#39;</span><span class="p">,</span> <span class="s">&#39;_proceed&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calls</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initializes the chain with the processors to be executed.</span>
<span class="sd">        </span>
<span class="sd">        @param calls: Iterable(callable)</span>
<span class="sd">            The iterable of callables to be executed. Attention the order in which the processors are provided</span>
<span class="sd">            is critical since one processor is responsible for delegating to the next.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">calls</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">),</span> <span class="s">&#39;Invalid processors </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">calls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="p">:</span> <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">proc</span><span class="p">),</span> <span class="s">&#39;Invalid processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">proc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_consumed</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="Chain.proceed"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Chain.proceed">[docs]</a>    <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Indicates to the chain that it should proceed with the chain execution after a processor has returned. </span>
<span class="sd">        The proceed is available only when the chain is in execution. The execution is continued with the same</span>
<span class="sd">        arguments.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proceed</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Chain.process"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Chain.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keyargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called in order to execute the next processors in the chain. This method will stop processing when all</span>
<span class="sd">        the processors have been executed.</span>
<span class="sd">        </span>
<span class="sd">        @param keyargs: key arguments</span>
<span class="sd">            The key arguments that are passed on to the next processors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">proceed</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="n">proceed</span><span class="p">:</span>
            <span class="n">proceed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proceed</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
                <span class="k">assert</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Processing </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">call</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">True</span>
                <span class="n">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keyargs</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Processing finalized </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">call</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">True</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proceed</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Proceed signal received, continue execution&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">True</span>
                    <span class="n">proceed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proceed</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Processing finalized by consuming&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_consumed</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Chain.isConsumed"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Chain.isConsumed">[docs]</a>    <span class="k">def</span> <span class="nf">isConsumed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks if the chain is consumed.</span>
<span class="sd">        </span>
<span class="sd">        @return: boolean</span>
<span class="sd">            True if all processors from the chain have been executed, False if a processor from the chain has stopped</span>
<span class="sd">            the execution of the other processors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_consumed</span>

<span class="c"># --------------------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="Handler"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Handler">[docs]</a><span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Handler base that provides a container for a processor.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processor</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the handler.</span>
<span class="sd">        </span>
<span class="sd">        @param processor: Processor</span>
<span class="sd">            The processor for the container.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
</div>
<div class="viewcode-block" id="HandlerProcessor"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.HandlerProcessor">[docs]</a><span class="k">class</span> <span class="nc">HandlerProcessor</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A handler that contains a processor derived on the contextual &#39;process&#39; function.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the handler with the processor automatically created from the &#39;process&#39; function.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">Contextual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">))</span>

    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="HandlerProcessor.process"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.HandlerProcessor.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="o">**</span><span class="n">keyargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The contextual process function used by the handler.</span>
<span class="sd">        </span>
<span class="sd">        @param chain: Chain</span>
<span class="sd">            The processing chain.</span>
<span class="sd">        &#39;&#39;&#39;</span>
</div></div>
<div class="viewcode-block" id="HandlerProcessorProceed"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.HandlerProcessorProceed">[docs]</a><span class="k">class</span> <span class="nc">HandlerProcessorProceed</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A handler that contains a processor derived on the contextual &#39;process&#39; function.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the handler with the processor automatically created from the &#39;process&#39; function.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">ContextualProceed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">))</span>

    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="HandlerProcessorProceed.process"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.HandlerProcessorProceed.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keyargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The contextual process function used by the handler, this process will not require a chain and will always</span>
<span class="sd">        proceed with the execution.</span>
<span class="sd">        &#39;&#39;&#39;</span>

<span class="c"># --------------------------------------------------------------------</span>
</div></div>
<span class="n">NO_INPUT_CONTEXTS_VALIDATION</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
<span class="c"># Assembly create flag that dictates that no input contexts missing validation should be performed.</span>
<span class="n">NO_MISSING_VALIDATION</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
<span class="c"># Assembly create flag that dictates that no missing validation should be performed.</span>
<span class="n">NO_VALIDATION</span> <span class="o">=</span> <span class="n">NO_INPUT_CONTEXTS_VALIDATION</span> <span class="o">|</span> <span class="n">NO_MISSING_VALIDATION</span>
<span class="c"># Assembly create flag that dictates that no validation should be performed.</span>

<span class="n">ONLY_AVAILABLE</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span>
<span class="c"># Assembly create flag that dictates that only the available processors should be used.</span>
<span class="n">CREATE_REPORT</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span>
<span class="c"># Assembly create flag that dictates that a report should be created, this will modify the return value for the create.</span>

<div class="viewcode-block" id="AssemblyError"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyError">[docs]</a><span class="k">class</span> <span class="nc">AssemblyError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Raised when there is a assembly problem.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</div>
<div class="viewcode-block" id="Assembly"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Assembly">[docs]</a><span class="k">class</span> <span class="nc">Assembly</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The assembly provides a container for the processors.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the assembly.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Assembly.add"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Assembly.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">processors</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add to the assembly the provided processors.</span>
<span class="sd">        </span>
<span class="sd">        @param processors: arguments[Processor|Handler|list[Processor|Handler]|tuple(Processor|Handler)]</span>
<span class="sd">            The processor(s) to be added to the assembly.</span>
<span class="sd">        @param before: Processor|Handler</span>
<span class="sd">            The processor(s) will be ordered before this processor, you can only specify before or after.</span>
<span class="sd">        @param after: Processor|Handler</span>
<span class="sd">            The processor(s) will be ordered after this processor, you can only specify after or before.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexFrom</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processorsFrom</span><span class="p">(</span><span class="n">processors</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">processor</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Assembly.move"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Assembly.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Moves in to the assembly the provided processor.</span>
<span class="sd">        </span>
<span class="sd">        @param processor: Processor|Handler</span>
<span class="sd">            The processor to be moved in to the assembly.</span>
<span class="sd">        @param before: Processor|Handler</span>
<span class="sd">            The processor(s) will be moved before this processor, you can only specify before or after.</span>
<span class="sd">        @param after: Processor|Handler</span>
<span class="sd">            The processor(s) will be moved after this processor, you can only specify after or before.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;You need to provide an after or a before processor in order to move&#39;</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processorFrom</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Unknown processor </span><span class="si">%s</span><span class="s"> in assembly&#39;</span> <span class="o">%</span> <span class="n">processor</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexFrom</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">processor</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.replace"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Assembly.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replaced</span><span class="p">,</span> <span class="n">replacer</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Replaces in to the assembly the provided processors.</span>
<span class="sd">        </span>
<span class="sd">        @param replaced: Processor|Handler</span>
<span class="sd">            The processor to be replaced in to the assembly.</span>
<span class="sd">        @param replacer: Processor|Handler</span>
<span class="sd">            The processor that will replace.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processorFrom</span><span class="p">(</span><span class="n">replaced</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Invalid replaced processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">replaced</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processorFrom</span><span class="p">(</span><span class="n">replacer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Assembly.create"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.Assembly.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">contexts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a processing based on all the processors in the assembly.</span>
<span class="sd">        </span>
<span class="sd">        @param flags: arguments[integer]</span>
<span class="sd">            Flags that dictate the behavior of the processing creation.</span>
<span class="sd">        @param contexts: key arguments of ContextMetaClass</span>
<span class="sd">            Key arguments that have as a value the context classes that the processing chain will be used with.</span>
<span class="sd">        @return: Processing|tuple of two</span>
<span class="sd">            processing: Processing</span>
<span class="sd">            A processing created based on the current structure of the assembly.</span>
<span class="sd">            report: string</span>
<span class="sd">            A text containing the report for the processing creation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s">&#39;Invalid flag </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span>
            <span class="n">flag</span> <span class="o">|=</span> <span class="n">f</span>

        <span class="n">processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span>
        <span class="n">assContext</span> <span class="o">=</span> <span class="n">AssemblyContext</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ONLY_AVAILABLE</span> <span class="o">|</span> <span class="n">CREATE_REPORT</span><span class="p">):</span>
            <span class="c"># Contains the unavailable processors as a tuples having on the first position the list of processors that</span>
            <span class="c"># are not available and on the second the attributes that determined the unavailability.</span>
            <span class="n">processorsAvailable</span><span class="p">,</span> <span class="n">processorsUnavailable</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">processors</span><span class="p">),</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">assContext</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">processorsAvailable</span><span class="p">,</span> <span class="n">contexts</span><span class="p">)</span>

                <span class="n">requiredOnly</span> <span class="o">=</span> <span class="n">assContext</span><span class="o">.</span><span class="n">requiredOnly</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">requiredOnly</span><span class="p">:</span> <span class="k">break</span>
                <span class="n">processorsAvailable</span><span class="p">,</span> <span class="n">excluded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterIfAny</span><span class="p">(</span><span class="n">processorsAvailable</span><span class="p">,</span> <span class="n">requiredOnly</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">excluded</span><span class="p">:</span> <span class="k">break</span>

                <span class="n">processorsUnavailable</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">excluded</span><span class="p">,</span> <span class="n">requiredOnly</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">ONLY_AVAILABLE</span><span class="p">:</span> <span class="n">processors</span> <span class="o">=</span> <span class="n">processorsAvailable</span>

        <span class="n">assContext</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span><span class="o">.</span><span class="n">addProcessors</span><span class="p">(</span><span class="n">processors</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="n">assContext</span><span class="o">.</span><span class="n">required</span><span class="p">()</span> <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">NO_INPUT_CONTEXTS_VALIDATION</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">assContext</span><span class="o">.</span><span class="n">addContexts</span><span class="p">(</span><span class="n">contexts</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">NO_MISSING_VALIDATION</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">missing</span> <span class="o">=</span> <span class="n">assContext</span><span class="o">.</span><span class="n">required</span><span class="p">()</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">assContext</span><span class="o">.</span><span class="n">defined</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Cannot resolve any definers for attributes:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                                    <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validateOrder</span><span class="p">(</span><span class="n">processors</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">processors</span><span class="p">:</span> <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;No processors available to create a processing&#39;</span><span class="p">)</span>

        <span class="n">processing</span> <span class="o">=</span> <span class="n">Processing</span><span class="p">(</span><span class="n">assContext</span><span class="o">.</span><span class="n">create</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="n">processors</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Processor</span><span class="p">),</span> <span class="s">&#39;Invalid processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span>
            <span class="n">processor</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">processing</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">CREATE_REPORT</span><span class="p">:</span>
            <span class="n">report</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">processorsUnavailable</span><span class="p">:</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">procs</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">processorsUnavailable</span><span class="p">:</span>
                    <span class="n">entry</span> <span class="o">=</span> <span class="s">&#39;Processors at:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span> <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">procs</span><span class="p">)</span>
                    <span class="n">entry</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\n\t</span><span class="s">-required attributes: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">attrs</span><span class="p">)))</span>
                    <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">The following processors have been removed because they require attributes that are &#39;</span>
                              <span class="s">&#39;not defined by any other processor:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entries</span><span class="p">))</span>

            <span class="n">definedOnly</span> <span class="o">=</span> <span class="n">assContext</span><span class="o">.</span><span class="n">definedOnly</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">definedOnly</span><span class="p">:</span>
                <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">The following attributes are not used by any processor:</span><span class="se">\n\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                              <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">definedOnly</span><span class="p">)))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span><span class="p">:</span> <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Nothing to report, everything fits nicely&#39;</span><span class="p">)</span>

            <span class="n">report</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">50</span> <span class="o">+</span> <span class="s">&#39; Assembly report&#39;</span><span class="p">)</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">processing</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">processing</span>

    <span class="c"># ----------------------------------------------------------------</span>
</div>
    <span class="k">def</span> <span class="nf">_processorFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processor</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provides an the processor from the provided processor or container.</span>
<span class="sd">        </span>
<span class="sd">        @param processor: Processor|Handler</span>
<span class="sd">            The processor or handler to get the processor for.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Processor</span><span class="p">):</span> <span class="k">return</span> <span class="n">processor</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Handler</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Handler</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">processor</span><span class="p">,</span> <span class="n">Processor</span><span class="p">),</span> \
            <span class="s">&#39;Invalid handler </span><span class="si">%s</span><span class="s"> processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">processor</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">processor</span><span class="o">.</span><span class="n">processor</span>

        <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Invalid processor or handler </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_processorsFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processors</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provides an iterable of the processors obtained from the provided processors or processors containers.</span>
<span class="sd">        </span>
<span class="sd">        @param processorsOrHandlers: Iterable[Processor|Handler|Assembly|</span>
<span class="sd">                                              list[Processor|Handler|Assembly]|tuple(Processor|Handler|Assembly)]</span>
<span class="sd">            The processors or processors containers to be made in an iterable of processors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processors</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">),</span> <span class="s">&#39;Invalid processors </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processors</span>

        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="n">processors</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processorsFrom</span><span class="p">(</span><span class="n">processor</span><span class="p">):</span> <span class="k">yield</span> <span class="n">processor</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Assembly</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Assembly</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span>  <span class="n">processor</span><span class="o">.</span><span class="n">_processors</span><span class="p">:</span> <span class="k">yield</span> <span class="n">processor</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processorFrom</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_indexFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provides the index where to insert based on the provided before and after processors.</span>
<span class="sd">        </span>
<span class="sd">        @param before: Processor|Handler</span>
<span class="sd">            The processor(s) will be moved before this processor, you can only specify before or after.</span>
<span class="sd">        @param after: Processor|Handler</span>
<span class="sd">            The processor(s) will be moved after this processor, you can only specify after or before.</span>
<span class="sd">        @return: integer</span>
<span class="sd">            The index where to insert.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processorFrom</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">after</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;Cannot have before and after at the same time&#39;</span>

            <span class="k">try</span><span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Unknown before processor </span><span class="si">%s</span><span class="s"> in assembly&#39;</span> <span class="o">%</span> <span class="n">before</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processorFrom</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processors</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">after</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Unknown after processor </span><span class="si">%s</span><span class="s"> in assembly&#39;</span> <span class="o">%</span> <span class="n">after</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">_indexAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processors</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Indexes the attributes dependencies for the provided processors.</span>
<span class="sd">        </span>
<span class="sd">        @param processors: Iterable(Processor)</span>
<span class="sd">            The list of processors to index the attributes for.</span>
<span class="sd">        @return: tuple of three</span>
<span class="sd">            definers: dictionary{integer, set(tuple(string, string))}</span>
<span class="sd">            optional: dictionary{integer, set(tuple(string, string))}</span>
<span class="sd">            requires: dictionary{integer, set(tuple(string, string))}</span>
<span class="sd">            </span>
<span class="sd">            The keys of the dictionaries are the index in the contained processors list of the processor that they</span>
<span class="sd">            represent. The values of the dictionaries are sets having tuples with the first position as the context </span>
<span class="sd">            argument name and as the second position the attribute name within the context.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processors</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">),</span> <span class="s">&#39;Invalid processors </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processors</span>

        <span class="n">definers</span><span class="p">,</span> <span class="n">optional</span><span class="p">,</span> <span class="n">requires</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">processor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">processors</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Processor</span><span class="p">),</span> <span class="s">&#39;Invalid processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">contexts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid processor contexts </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span><span class="o">.</span><span class="n">contexts</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">processor</span><span class="o">.</span><span class="n">contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">ContextMetaClass</span><span class="p">),</span> <span class="s">&#39;Invalid context class </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">context</span>

                <span class="k">for</span> <span class="n">nameAttribute</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">__attributes__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">Attribute</span><span class="p">),</span> <span class="s">&#39;Invalid attribute </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">attribute</span>

                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nameAttribute</span><span class="p">)</span>

                    <span class="c"># Indexing the definers, optional and requires for the attribute</span>
                    <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">DEFINED</span><span class="p">:</span>
                        <span class="n">attrs</span> <span class="o">=</span> <span class="n">definers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">attrs</span> <span class="o">=</span> <span class="n">definers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                        <span class="n">attrs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">attribute</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">OPTIONAL</span><span class="p">:</span>
                        <span class="n">attrs</span> <span class="o">=</span> <span class="n">optional</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">attrs</span> <span class="o">=</span> <span class="n">optional</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                        <span class="n">attrs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">attrs</span> <span class="o">=</span> <span class="n">requires</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">attrs</span> <span class="o">=</span> <span class="n">requires</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                        <span class="n">attrs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">definers</span><span class="p">,</span> <span class="n">optional</span><span class="p">,</span> <span class="n">requires</span>

    <span class="k">def</span> <span class="nf">_indexDependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processors</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Indexes the dependencies of the processors of this assembly.</span>
<span class="sd">        </span>
<span class="sd">        @param processors: Iterable(Processor)</span>
<span class="sd">            The list of processors to index the dependencies for.</span>
<span class="sd">        @param dependencies: list[set(integer)]</span>
<span class="sd">            A list containing the dependencies for the processor, the list index is the index in the list of the</span>
<span class="sd">            processors list of the corresponding processor, the value is a set of integers representing the processors</span>
<span class="sd">            that are required to be before the indexed processor.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processors</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">),</span> <span class="s">&#39;Invalid processors </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processors</span>

        <span class="n">definers</span><span class="p">,</span> <span class="n">_optional</span><span class="p">,</span> <span class="n">requires</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexAttributes</span><span class="p">(</span><span class="n">processors</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">definers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid definers </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">definers</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">requires</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid requires </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">requires</span>

        <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">processors</span><span class="p">)):</span>
            <span class="n">beforeProcessor</span><span class="p">,</span> <span class="n">afterProcessor</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">definersProc</span> <span class="o">=</span> <span class="n">definers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">())</span>
            <span class="n">requiresProc</span> <span class="o">=</span> <span class="n">requires</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">indexOther</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
                <span class="n">definersOther</span> <span class="o">=</span> <span class="n">definers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">indexOther</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">())</span>
                <span class="n">requiresOther</span> <span class="o">=</span> <span class="n">requires</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">indexOther</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">())</span>

                <span class="n">definesRequired</span> <span class="o">=</span> <span class="n">definersProc</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">requiresOther</span><span class="p">)</span>
                <span class="n">otherDefinesRequired</span> <span class="o">=</span> <span class="n">definersOther</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">requiresProc</span><span class="p">)</span>

                <span class="n">isSmaller</span><span class="p">,</span> <span class="n">isOtherSmaller</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">otherDefinesRequired</span><span class="p">:</span>
                    <span class="c"># Check if index defines anything for other index</span>
                    <span class="n">isOtherSmaller</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="n">definesRequired</span><span class="p">:</span>
                        <span class="c"># The other index defines stuff for index we need to check if doesn&#39;t apply reversed</span>
                        <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;First processor defines attributes </span><span class="si">%s</span><span class="s"> required by the second processor&#39;</span>
                        <span class="s">&#39;, but also the second processor defines attributes </span><span class="si">%s</span><span class="s"> required by the first processor:&#39;</span>
                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">First processor at:</span><span class="si">%s</span><span class="se">\n</span><span class="s">Second processor at:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                        <span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">definesRequired</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">otherDefinesRequired</span><span class="p">],</span>
                        <span class="n">location</span><span class="p">(</span><span class="n">processors</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">location</span><span class="p">(</span><span class="n">processors</span><span class="p">[</span><span class="n">indexOther</span><span class="p">])))</span>

                <span class="k">elif</span> <span class="n">definesRequired</span><span class="p">:</span> <span class="n">isSmaller</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="k">if</span> <span class="n">isOtherSmaller</span><span class="p">:</span>
                    <span class="n">beforeProcessor</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">indexOther</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">isSmaller</span><span class="p">:</span>
                    <span class="n">afterProcessor</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">indexOther</span><span class="p">)</span>
                    <span class="n">dependencies</span><span class="p">[</span><span class="n">indexOther</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">beforeProcessor</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">aindex</span> <span class="ow">in</span> <span class="n">afterProcessor</span><span class="p">:</span>
                    <span class="n">dependencies</span><span class="p">[</span><span class="n">aindex</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">beforeProcessor</span><span class="p">)</span>

            <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beforeProcessor</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dependencies</span>

    <span class="k">def</span> <span class="nf">_filterIfAny</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processors</span><span class="p">,</span> <span class="n">requires</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Filters the processors by excluding based on the attributes.</span>
<span class="sd">        </span>
<span class="sd">        @param processors: Iterable(Processor)</span>
<span class="sd">            The list of processors to filter.</span>
<span class="sd">        @param requires: set(tuple(string, string))</span>
<span class="sd">            The attributes that need not to be required by the filtered processors.</span>
<span class="sd">            The sets contain tuples having on the first position the context argument name and as the second</span>
<span class="sd">            position the attribute name within the context.</span>
<span class="sd">        @return: tuple of two</span>
<span class="sd">            filtered: list[Processor]</span>
<span class="sd">                The list of filtered processors.</span>
<span class="sd">            excluded: list[Processor]</span>
<span class="sd">                The list of excluded processors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processors</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">),</span> <span class="s">&#39;Invalid processors </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processors</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">requires</span><span class="p">,</span> <span class="nb">set</span><span class="p">),</span> <span class="s">&#39;Invalid requires </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">requires</span>

        <span class="n">filtered</span><span class="p">,</span> <span class="n">excluded</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="n">processors</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Processor</span><span class="p">),</span> <span class="s">&#39;Invalid processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">contexts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid processor contexts </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span><span class="o">.</span><span class="n">contexts</span>

            <span class="n">valid</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">processor</span><span class="o">.</span><span class="n">contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">ContextMetaClass</span><span class="p">),</span> <span class="s">&#39;Invalid context class </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">context</span>

                <span class="k">for</span> <span class="n">nameAttribute</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">__attributes__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">Attribute</span><span class="p">),</span> <span class="s">&#39;Invalid attribute </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">attribute</span>

                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nameAttribute</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">REQUIRED</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">requires</span><span class="p">:</span>
                            <span class="n">valid</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span> <span class="k">break</span>

            <span class="k">if</span> <span class="n">valid</span><span class="p">:</span> <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">excluded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered</span><span class="p">,</span> <span class="n">excluded</span>

    <span class="k">def</span> <span class="nf">_validateOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processors</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Validates if the order of the processors is correct.</span>
<span class="sd">        </span>
<span class="sd">        @param processors: list[Processor]</span>
<span class="sd">            The list of processors to check for the order.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processors</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s">&#39;Invalid processors </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processors</span>

        <span class="n">dependencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexDependencies</span><span class="p">(</span><span class="n">processors</span><span class="p">)</span>

        <span class="n">before</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">processors</span><span class="p">)):</span>
            <span class="n">requiredAfter</span> <span class="o">=</span> <span class="n">dependencies</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">requiredAfter</span><span class="p">:</span>
                <span class="n">broken</span> <span class="o">=</span> <span class="n">requiredAfter</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">requiredAfter</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">before</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">broken</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;The processor at:</span><span class="si">%s</span><span class="se">\n</span><span class="s">needs to have the processors after it, not before &#39;</span>
                                        <span class="s">&#39;it:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">location</span><span class="p">(</span><span class="n">processors</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span>
                                                   <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">(</span><span class="n">processors</span><span class="p">[</span><span class="n">bindex</span><span class="p">])</span> <span class="k">for</span> <span class="n">bindex</span> <span class="ow">in</span> <span class="n">broken</span><span class="p">)))</span>

            <span class="n">before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AssemblyContext"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyContext">[docs]</a><span class="k">class</span> <span class="nc">AssemblyContext</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Contains the data for an attribute assembly.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;attributes&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the attributes assembly.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">definedOnly</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">DEFINED</span><span class="p">)</span>
    <span class="n">defined</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">DEFINED</span><span class="p">)</span>
    <span class="n">optionalOnly</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">OPTIONAL</span><span class="p">)</span>
    <span class="n">optional</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">OPTIONAL</span><span class="p">)</span>
    <span class="n">requiredOnly</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">REQUIRED</span><span class="p">)</span>
    <span class="n">required</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">REQUIRED</span><span class="p">)</span>

<div class="viewcode-block" id="AssemblyContext.create"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyContext.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates the contexts based on this assembly.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="s">&#39;No attributes available&#39;</span>

        <span class="n">contexts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">assAttr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assAttr</span><span class="p">,</span> <span class="n">AssemblyAttribute</span><span class="p">)</span>

            <span class="n">name</span><span class="p">,</span> <span class="n">nameAttribute</span> <span class="o">=</span> <span class="n">key</span>

            <span class="n">attributes</span> <span class="o">=</span> <span class="n">contexts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">contexts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span> <span class="n">attributes</span><span class="p">[</span><span class="n">nameAttribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">assAttr</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">AssemblyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Cannot create attribute </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s"> from context </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nameAttribute</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">ContextMetaClass</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">(</span><span class="n">Context</span><span class="p">,),</span> <span class="n">attributes</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span> <span class="ow">in</span> <span class="n">contexts</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c"># ----------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="AssemblyContext.add"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyContext.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contexts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds processors or contexts or both to this assembly.</span>
<span class="sd">        </span>
<span class="sd">        @param processors: Iterable(Processor)|None</span>
<span class="sd">            The processors to add.</span>
<span class="sd">        @param contexts: dictionary{string, ContextMetaClass}|None</span>
<span class="sd">            The contexts to add.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">processors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addProcessors</span><span class="p">(</span><span class="n">processors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contexts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addContexts</span><span class="p">(</span><span class="n">contexts</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AssemblyContext.addProcessors"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyContext.addProcessors">[docs]</a>    <span class="k">def</span> <span class="nf">addProcessors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processors</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add the processors to this attributes assembly.</span>
<span class="sd">        </span>
<span class="sd">        @param processors: Iterable(Processor)</span>
<span class="sd">            The processors to add.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processors</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">),</span> <span class="s">&#39;Invalid processors </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processors</span>

        <span class="k">for</span> <span class="n">processor</span> <span class="ow">in</span> <span class="n">processors</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Processor</span><span class="p">),</span> <span class="s">&#39;Invalid processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">contexts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid processor contexts </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span><span class="o">.</span><span class="n">contexts</span>

            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addContexts</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">contexts</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AssemblyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Cannot assemble attributes for processor at:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">location</span><span class="p">(</span><span class="n">processor</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AssemblyContext.addContexts"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyContext.addContexts">[docs]</a>    <span class="k">def</span> <span class="nf">addContexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contexts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add the contexts to this attributes assembly.</span>
<span class="sd">        </span>
<span class="sd">        @param contexts: dictionary{string, ContextMetaClass}</span>
<span class="sd">            The contexts to add.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contexts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s">&#39;Invalid contexts </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">contexts</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s">&#39;Invalid context name </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">ContextMetaClass</span><span class="p">),</span> <span class="s">&#39;Invalid context class </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">context</span>

            <span class="k">for</span> <span class="n">nameAttribute</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">__attributes__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">Attribute</span><span class="p">),</span> <span class="s">&#39;Invalid attribute </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">attribute</span>

                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nameAttribute</span><span class="p">)</span>

                <span class="n">assAttr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">assAttr</span><span class="p">:</span> <span class="n">assAttr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">AssemblyAttribute</span><span class="p">()</span>

                <span class="k">try</span><span class="p">:</span> <span class="n">assAttr</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">AssemblyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Cannot assemble attribute </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s"> from context </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nameAttribute</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AssemblyContext.clear"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyContext.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Clears the assembly of any attributes and data.</span>
<span class="sd">        </span>
<span class="sd">        @return: self</span>
<span class="sd">            Same instance for chaining purposes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
</div></div>
<div class="viewcode-block" id="AssemblyAttribute"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyAttribute">[docs]</a><span class="k">class</span> <span class="nc">AssemblyAttribute</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Contains the data for an attribute assembly.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;status&#39;</span><span class="p">,</span> <span class="s">&#39;defined&#39;</span><span class="p">,</span> <span class="s">&#39;required&#39;</span><span class="p">,</span> <span class="s">&#39;doc&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Construct the attribute assembly.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defined</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="AssemblyAttribute.create"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyAttribute.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates the attribute based on this assembly.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">types</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Invalid defined </span><span class="si">%s</span><span class="s"> and required </span><span class="si">%s</span><span class="s"> assembly types&#39;</span> <span class="o">%</span>
                                    <span class="p">([</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">],</span> <span class="p">[</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">:</span> <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span> <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;Invalid assembly has no types&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">types</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>

    <span class="c"># ----------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="AssemblyAttribute.add"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.AssemblyAttribute.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Combines this attribute assembly with the provided attribute.</span>
<span class="sd">        </span>
<span class="sd">        @param attr: Attribute</span>
<span class="sd">            The attributes to be combined with.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">Attribute</span><span class="p">),</span> <span class="s">&#39;Invalid attribute </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">attribute</span>

        <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">DEFINED</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;The defined assembly types </span><span class="si">%s</span><span class="s"> are not compatible with the defined types </span><span class="si">%s</span><span class="s"> &#39;</span>
                                        <span class="s">&#39;of attribute </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">([</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">],</span>
                                                             <span class="p">[</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">],</span> <span class="n">attribute</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">intersection_update</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">REQUIRED</span> <span class="o">|</span> <span class="n">OPTIONAL</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;The required assembly types </span><span class="si">%s</span><span class="s"> are not compatible with the required types </span><span class="si">%s</span><span class="s"> &#39;</span>
                                        <span class="s">&#39;of attribute </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">([</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">],</span>
                                                             <span class="p">[</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">],</span> <span class="n">attribute</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="o">.</span><span class="n">intersection_update</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">types</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">AssemblyError</span><span class="p">(</span><span class="s">&#39;The defined attributes types </span><span class="si">%s</span><span class="s"> are not compatible with the required types </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="p">([</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">],</span> <span class="p">[</span><span class="n">typ</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">|=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">status</span>

        <span class="n">docs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">docs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c"># --------------------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="location"><a class="viewcode-back" href="../../../ally.design.html#ally.design.processor.location">[docs]</a><span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="n">processor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Provides a processor location message used for exceptions.</span>
<span class="sd">    </span>
<span class="sd">    @param index: integer</span>
<span class="sd">        The processor index to have the location message.</span>
<span class="sd">    @return: string</span>
<span class="sd">        The location message.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">Processor</span><span class="p">),</span> <span class="s">&#39;Invalid processor </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">processor</span>

    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  File &quot;</span><span class="si">%s</span><span class="s">&quot;, line </span><span class="si">%i</span><span class="s">, in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">fileName</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">lineNumber</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ally-py 1.0b1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Gabriel Nistor.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>